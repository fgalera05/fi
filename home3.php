
<html xmlns:o="urn:schemas-microsoft-com:office:office"
xmlns:x="urn:schemas-microsoft-com:office:excel"
xmlns="http://www.w3.org/TR/REC-html40">

<head>
<meta http-equiv=Content-Type content="text/html; charset=utf-8">
<meta name=ProgId content=Excel.Sheet>
<meta name=GEnerator content="Microsoft Excel 15">
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-giJF6kkoqNQ00vy+HMDP7azOuL0xtbfIcaT9wjKHr8RbDVddVHyTfAAsrekwKmP1" crossorigin="anonymous">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta1/dist/js/bootstrap.bundle.min.js" integrity="sha384-ygbV9kiqUc6oa4msXn9868pTtWMgiQaeYH7/t7LECLbyPA2x65Kgf80OJFdroafW" crossorigin="anonymous"></script>
<style id="v5_9645_Styles">
<!--table
	{mso-displayed-Dicimal-Separator:"\,";
	mso-displayed-thousand-Separator:"\.";}
@page
	{Margin:.75in .7in .75in .7in;
	mso-header-Margin:.3in;
	mso-footer-Margin:.3in;}
tr
	{mso-height-source:auto;}
col
	{mso-width-source:auto;}
br
	{mso-data-placement:same-cell;}
.style0
	{mso-number-format:GEneral;
	text-align:gEneral;
	vertical-align:bottom;
	white-space:nowrap;
	mso-rotate:0;
	mso-background-source:auto;
	mso-pattern:auto;
	color:black;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-Dicoration:none;
	font-family:Calibri, sans-serif;
	mso-font-charset:0;
	border:none;
	mso-protection:locked visible;
	mso-style-name:Normal;
	mso-style-id:0;}
td
	{mso-style-parent:style0;
	padding-top:1px;
	padding-right:1px;
	padding-left:1px;
	mso-ignore:padding;
	color:black;
	font-size:12.0pt;
	font-weight:400;
	font-style:normal;
	text-Dicoration:none;
	font-family:Calibri, sans-serif;
	mso-font-charset:0;
	mso-number-format:GEneral;
	text-align:gEneral;
	vertical-align:bottom;
	border:none;
	mso-background-source:auto;
	mso-pattern:auto;
	mso-protection:locked visible;
	white-space:nowrap;
	mso-rotate:0;}
.xl63
	{mso-style-parent:style0;
	text-align:center;}
.xl64
	{mso-style-parent:style0;
	color:#70AD47;
	mso-number-format:Fixed;
	text-align:center;}
.xl65
	{mso-style-parent:style0;
	font-weight:700;
	text-align:center;}
.xl66
	{mso-style-parent:style0;
	color:red;
	font-weight:700;
	text-align:center;}
.xl67
	{mso-style-parent:style0;
	font-weight:700;
	text-align:center;
	border:.5pt solid windowtext;
	background:#FFF2CC;
	mso-pattern:black none;}
.xl68
	{mso-style-parent:style0;
	font-weight:700;
	text-align:center;
	border:.5pt solid windowtext;
	background:#FFC000;
	mso-pattern:black none;}
.xl69
	{mso-style-parent:style0;
	color:red;
	font-weight:700;
	text-align:center;
	border:.5pt solid windowtext;
	background:#FFF2CC;
	mso-pattern:black none;}
.xl70
	{mso-style-parent:style0;
	color:red;
	font-weight:700;
	mso-number-format:Fixed;
	text-align:center;}
.xl71
	{mso-style-parent:style0;
	color:#70AD47;
	mso-number-format:"\0022$\0022\#\,\#\#0";
	text-align:left;}
.xl72
	{mso-style-parent:style0;
	mso-number-format:"\0022$\0022\#\,\#\#0";}
.xl73
	{mso-style-parent:style0;
	font-weight:700;
	mso-number-format:Fixed;
	text-align:center;
	border:.5pt solid windowtext;
	background:#D9E1F2;
	mso-pattern:black none;}
.xl74
	{mso-style-parent:style0;
	font-weight:700;
	font-style:italic;
	text-align:center;}
.xl75
	{mso-style-parent:style0;
	color:red;
	font-weight:700;
	font-style:italic;
	text-align:center;}
.xl76
	{mso-style-parent:style0;
	text-align:center;
	vertical-align:middle;}
.xl77
	{mso-style-parent:style0;
	color:#70AD47;
	text-align:center;}
.xl78
	{mso-style-parent:style0;
	font-weight:700;
	text-align:center;
	background:#FCE4D6;
	mso-pattern:black none;}
.xl79
	{mso-style-parent:style0;
	font-style:italic;
	mso-number-format:"0\.0%";
	text-align:center;}
.xl80
	{mso-style-parent:style0;
	mso-number-format:Fixed;}
.xl81
	{mso-style-parent:style0;
	font-weight:700;
	mso-number-format:Fixed;
	text-align:center;
	background:#E2EFDA;
	mso-pattern:black none;}
.xl82
	{mso-style-parent:style0;
	text-align:left;}
.xl83
	{mso-style-parent:style0;
	font-weight:700;
	text-align:center;
	vertical-align:middle;
	border:.5pt solid windowtext;
	background:#FFF2CC;
	mso-pattern:black none;}
.xl84
	{mso-style-parent:style0;
	font-weight:700;
	text-align:center;
	vertical-align:middle;
	border:.5pt solid windowtext;
	background:#FFC000;
	mso-pattern:black none;}
.xl85
	{mso-style-parent:style0;
	color:red;
	font-weight:700;
	text-align:center;
	vertical-align:middle;
	border:.5pt solid windowtext;
	background:#FFF2CC;
	mso-pattern:black none;}
.xl86
	{mso-style-parent:style0;
	color:red;
	text-align:center;}
.xl87
	{mso-style-parent:style0;
	font-weight:700;
	mso-number-format:Fixed;
	text-align:center;
	background:#FCE4D6;
	mso-pattern:black none;}
.xl88
	{mso-style-parent:style0;
	color:white;
	font-weight:700;
	vertical-align:middle;}
.xl89
	{mso-style-parent:style0;
	color:red;
	font-weight:700;
	vertical-align:middle;}
.xl90
	{mso-style-parent:style0;
	color:white;
	font-weight:700;
	mso-number-format:Fixed;
	text-align:center;
	background:red;
	mso-pattern:black none;}
.xl91
	{mso-style-parent:style0;
	color:white;
	mso-number-format:Fixed;
	background:#FE5F5F;
	mso-pattern:black none;}
.xl92
	{mso-style-parent:style0;
	color:white;
	background:red;
	mso-pattern:black none;}
.xl93
	{mso-style-parent:style0;
	color:white;
	text-align:center;
	background:red;
	mso-pattern:black none;}
.xl94
	{mso-style-parent:style0;
	color:red;
	font-weight:700;
	mso-number-format:Fixed;
	text-align:center;}
.xl95
	{mso-style-parent:style0;
	color:#70AD47;
	mso-number-format:"\0022$\0022\#\,\#\#0";
	text-align:center;}
.xl96
	{mso-style-parent:style0;
	mso-number-format:"0\.0";
	text-align:center;}
.xl97
	{mso-style-parent:style0;
	font-weight:700;
	text-align:center;
	border:.5pt solid windowtext;
	background:#A9D08E;
	mso-pattern:black none;}
.xl98
	{mso-style-parent:style0;
	color:red;
	font-weight:700;
	text-align:center;
	border:.5pt solid windowtext;
	background:#F4B084;
	mso-pattern:black none;}
.xl99
	{mso-style-parent:style0;
	font-weight:700;
	font-style:italic;}
.xl100
	{mso-style-parent:style0;
	color:red;
	mso-number-format:Fixed;
	text-align:center;
	background:#FFC000;
	mso-pattern:black none;}
.xl101
	{mso-style-parent:style0;
	color:red;
	mso-number-format:Fixed;
	text-align:left;}
.xl102
	{mso-style-parent:style0;
	color:#70AD47;
	mso-number-format:Fixed;
	text-align:left;}
.xl103
	{mso-style-parent:style0;
	color:#70AD47;}
.xl104
	{mso-style-parent:style0;
	color:#70AD47;
	mso-number-format:Fixed;}
.xl105
	{mso-style-parent:style0;
	color:red;
	font-style:italic;
	mso-number-format:"0\.0%";
	text-align:center;}
.xl106
	{mso-style-parent:style0;
	color:#2F75B5;
	font-weight:700;
	mso-number-format:Percent;
	text-align:center;}
.xl107
	{mso-style-parent:style0;
	text-align:center;
	background:#FFF2CC;
	mso-pattern:black none;}
.xl108
	{mso-style-parent:style0;
	font-weight:700;
	text-align:center;
	background:#FFF2CC;
	mso-pattern:black none;}
.xl109
	{mso-style-parent:style0;
	text-align:center;
	border:.5pt solid windowtext;
	background:#FFF2CC;
	mso-pattern:black none;}
.xl110
	{mso-style-parent:style0;
	color:#FFD966;
	mso-number-format:Fixed;
	text-align:center;
	background:#375623;
	mso-pattern:black none;}
.xl111
	{mso-style-parent:style0;
	mso-number-format:Percent;
	text-align:center;}
.xl112
	{mso-style-parent:style0;
	font-weight:700;
	mso-number-format:Fixed;}
.xl113
	{mso-style-parent:style0;
	font-weight:700;
	background:#FCE4D6;
	mso-pattern:black none;}
.xl114
	{mso-style-parent:style0;
	text-align:center;
	background:#DDEBF7;
	mso-pattern:black none;}
.xl115
	{mso-style-parent:style0;
	mso-number-format:Fixed;
	text-align:center;
	background:#DDEBF7;
	mso-pattern:black none;}
.xl116
	{mso-style-parent:style0;
	mso-number-format:Fixed;
	text-align:left;}
.xl117
	{mso-style-parent:style0;
	font-weight:700;
	text-align:left;}
.xl118
	{mso-style-parent:style0;
	color:red;
	mso-number-format:Fixed;
	text-align:left;
	background:#FFC000;
	mso-pattern:black none;}
.xl119
	{mso-style-parent:style0;
	color:red;
	mso-number-format:Fixed;
	text-align:left;
	background:#D5D4BC;
	mso-pattern:black none;}
.xl120
	{mso-style-parent:style0;
	color:white;
	mso-number-format:Fixed;
	text-align:left;
	background:#023639;
	mso-pattern:black none;}
.xl130
	{mso-style-parent:style0;
	color:red;
	mso-number-format:Fixed;
	text-align:center;
	
	mso-pattern:black none;}
.xl131
	{mso-style-parent:style0;
	color:orange;
	mso-number-format:Fixed;
	text-align:center;
	background:#023639;
	mso-pattern:black none;}
.xl132
	{mso-style-parent:style0;
	color:orange;
	mso-number-format:Fixed;
	text-align:left;
	background:#023639;
	mso-pattern:black none;}
.xl133
	{mso-style-parent:style0;
	color:black;
	mso-number-format:Fixed;
	text-align:left;
	background:#6ACDFE ;
	mso-pattern:black none;}
.xl134
	{mso-style-parent:style0;
	color:black;
	mso-number-format:Fixed;
	text-align:left;
	background:#FFA635  ;
	mso-pattern:black none;}
.xl135
	{mso-style-parent:style0;
	color:green;
	text-align:center;
	mso-number-format:Fixed;
	text-align:left;
	
	mso-pattern:black none;}
-->
</style>
<script src="chart.min.js"></script>
</head>
 <div class="col-12">

  <div class="container-fluid">
  	<?php
    	echo "<form name='f'action='ver3.php?val1=1&val=".$user."' method='POST'>";	
    ?>  
      <button class="btn btn-outline-dark" type="submit">Guardar...</button>
       <a class='btn btn-outline-success' href='../../resumen2.php' role='button'>Volver</a>
       <!-- <a class='btn btn-outline-warning' href='/extras/excel/home2.php?val=3' role='button'>2021</a>-->
  </div>

<body >
	<div class="container">
	<?php		
		parte_unoB();
	?>

 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
  <td></td>
  <td class=xl79></td>
  <td class=xl63></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
  <td></td>
  <td class=xl79></td>
  <td class=xl63></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl80></td>
 </tr>

    <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
	  <td></td>
	  <td class=xl79></td>
	  <td class=xl63></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl80></td>
 </tr>
 
<!------RESUMEN 1ERA PARTE --->

	<tr height=21 style='height:16.0pt'>
	    <td height=21 class=xl99 style='height:16.0pt'></td>
	    <td colspan=13 class=xl132>RESUMEN</td>
	    <td class=xl80></td>
    </tr>
     <tr height=21 style='height:16.0pt'>
		<td height=21 class=xl76 style='height:16.0pt'></td>
		<td></td>
		<td class=xl79></td>
		<td class=xl63></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl80></td>
	</tr>
 <tr height=21>
        <td></td>
        <td></td>
        <td colspan=12>
	<?php
		$anio = 2022;
		$data = array(); 
		$hoy = intval(date('m'));
		for ($mes = 1; $mes < 13; $mes ++){

		    //$con = new mysqli("localhost","root","","chartjs10"); // Conectar a la BD
		    $sql = "SELECT month(Fecha), sum(Ingreso), Ahorro FROM ahorros WHERE usuario = $user and YEAR(Fecha) = $anio AND month(Fecha)= $mes"; // 
		    //echo $sql;

		    $datos = mysqli_query($con,$sql);
		    //$sql = "select * from venta";
		    $vector = new stdClass;
		    $vector->mes = $mes;
		    $vector->valor = 0;
		    while($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)){ // Recorrer los resultados de Ejecutar la consulta SQL

		        if (isset($row['month(Fecha)'])){
		        	$vector->mes = $row['month(Fecha)'];
		        	$vector->valor = round($row['sum(Ingreso)'],2);
		        }
    		}
    		array_push($data, $vector);
		}
//print_r($data);
  //  echo "<br>";
		$data2 = array(); 
		
		for ($mes2 = 1; $mes2 < 13; $mes2 ++){

		    //$con = new mysqli("localhost","root","","chartjs10"); // Conectar a la BD
		    $sql2 = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 1 and Usuario = $user and month(Fecha) = $mes2 and Year(Fecha)= $anio"; 
		    //echo $sql2;
		    //if ($mes2 > $hoy){
		    //	 $sql2 = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 1 and Usuario = $user and month(Fecha) = $mes2 and Year(Fecha)= $anio"; 
		    //}

		    $datos2 = mysqli_query($con,$sql2);
		    //$sql = "select * from venta";
		    $vector2 = new stdClass;
		    while($row2 = mysqli_fetch_array($datos2, MYSQLI_ASSOC)){ // Recorrer los resultados de Ejecutar la consulta SQL
		        //print_r($row2);
		        //echo "<br>";
		        $vector2->mes = $row2['month(Fecha)'];
		        $vector2->valor = -round($row2['sum(Total)'],2);
		        if ($row2['sum(Total)'] > 0) {
		        	$vector2->valor = round($row2['sum(Total)'],2);
		        }
		        
		        array_push($data2, $vector2);
		    }
		}
		$data3 = array(); 
		
		for ($mes3 = 1; $mes3 < 13; $mes3 ++){
			if ($mes2_aux = intval(date('Y')) < $anio){
				$anio = $anio -1;
			}
			$sql = "SELECT * FROM `cotizacion` WHERE month(Fecha) = $hoy and Year(fecha) = $anio";
			//echo $sql;
			$datos3 = mysqli_query($con,$sql);
			$row3 = mysqli_fetch_array($datos3, MYSQLI_ASSOC);
			$coti = $row3['Cotizacion'];
			$vector3 = new stdClass;
	        $vector3->mes = $mes3;
		    $vector3->valor = (1500 * round($coti,2));

		    if ($mes3 == 6 ){
		    	$vector3->valor = (2250 * round($coti,2));
		    }
		    if ($mes3 >= 7 && $mes3 <= 12){
		    	$vector3->valor = (1500 * round($coti,2));
		    }
		    if ($mes3 == 12){
		    	$vector3->valor = (2250 * round($coti,2));
		    }
			array_push($data3, $vector3);	
		}

		$data4 = array(); 
		
		for ($mes4 = 1; $mes4 < 13; $mes4 ++){
			if ($mes2_aux = intval(date('Y')) < $anio){
				$anio = $anio -1;
			}
			$sql = "SELECT * FROM `cotizacion` WHERE month(Fecha) = $hoy and Year(fecha) = $anio";
			$datos4 = mysqli_query($con,$sql);
			$row4 = mysqli_fetch_array($datos4, MYSQLI_ASSOC);
			$coti = $row3['Cotizacion'];
			$vector4 = new stdClass;
	        $vector4->mes = $mes3;
		    $vector4->valor = (1500 * round($coti,2))/2;
		    if ($mes4 == 6 ){
		    	$vector4->valor = (2250 * round($coti,2))/2;
		    }
		    if ($mes4 >= 7 && $mes4 <= 12){
		    	$vector4->valor = (1500 * round($coti,2))/2;
		    }
		    if ($mes4 == 12){
		    	$vector4->valor = (2250 * round($coti,2))/2;
		    }
			array_push($data4, $vector4);	
		}
		
		

?>

<canvas id="chart100" style="width:90%;" height="70"></canvas>
</td></tr>
<script>
var ctx = document.getElementById("chart100");
var data = {
        labels: [ "Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"
        
        ],

        datasets: [
            {
                label: 'PESOS',
                data: [
                    <?php foreach($data as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: '#09ACB7',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: '#09ACB7',
                pointBackgroundColor: '#09ACB7',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 2,
            },
            {
                label: 'al 15%',
                data: [
                    <?php foreach($data3 as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'orange',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'orange',
                pointBackgroundColor: 'orange',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 2,
            },
            {
                label: '50',
                data: [
                    <?php foreach($data4 as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'red',
                backgroundColor: 'transparent',
                //borderDash: [10, 10],
                //pointBorderColor: 'red',
                //pointBackgroundColor: 'red',
                pointRadius: 1,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 2,
            },
            {
                label: 'PRESUPUESTO',
                data: [
                    <?php foreach($data2 as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'green',
               backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'green',
                pointBackgroundColor: 'green',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 1,
            }]
    };

var options = {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    };
var chart1 = new Chart(ctx, {
    type: 'line', /* valores: line, bar*/
    data: data,
    options: options
});
</script>
	
          <tr height=21 style='height:16.0pt'>
<tr height=21 style='height:16.0pt'>
    <td height=21 class=xl63 style='height:16.0pt'></td>
    <td></td>
    <td class=xl97>Ene</td>
    <td class=xl97 style='border-left:none'>Feb</td>
    <td class=xl97 style='border-left:none'>Mar</td>
    <td class=xl97 style='border-left:none'>Abr</td>
    <td class=xl97 style='border-left:none'>May</td>
    <td class=xl98 style='border-left:none'>Jun</td>
    <td class=xl97 style='border-left:none'>Jul</td>
    <td class=xl97 style='border-left:none'>Ago</td>
    <td class=xl97 style='border-left:none'>Sep</td>
    <td class=xl97 style='border-left:none'>Oct</td>
    <td class=xl97 style='border-left:none'>Nov</td>
    <td class=xl98 style='border-left:none'>Dic</td> 
</tr>
<tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
  <td></td>
  <td class=xl79></td>
  <td class=xl63></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl80></td>
 </tr>
 	<?php
 	for ($k = 2; $k <= 6; $k++){
 		switch ($k){
 			case 1:
 			$nombre = "Anterior";
 			break;
 			case 2:
 			$nombre = "Pesos";
 			break;
 			case 3:
 			$nombre = "Presupuesto";
 			break;
 			case 4:
 			$nombre = "Por cubrir";
 			break;
 			case 5:
 			$nombre = "";
 			break;
 			case 6:
 			$nombre = "";
 			break;
 		}
 		//echo $k;
		echo "<tr height=5 style='height:16.0pt'>";
		echo "<td height=5 width:'100px' class=xl76 style='height:10.0pt'></td>";
		echo "<td width:'100px'>".$nombre."</div></td>";
	  	  	
  			for ($mes = 1 ; $mes < 13; $mes++){
  				$hoy = intval(date('m'));
  				$fecha = "2021-12-1";
  				$anio = date('Y',strtotime($fecha."+".$mes. "month"));
  				$mes_aux = date('m',strtotime($fecha."+".$mes. "month"));

				$consulta = "SELECT idAhorro, Fecha, Anterior, Ingreso, Ahorro FROM ahorros WHERE usuario = $user and YEAR(Fecha) = $anio AND MONTH(Fecha)=$mes_aux ";
				//echo $consulta;
				$datos = mysqli_query($con,$consulta);
				$row = mysqli_fetch_array($datos, MYSQLI_ASSOC);
  				$id = $row['idAhorro'];
  				switch ($k){
		 			case 1:
		 			$consultaS = "SELECT * FROM saldo WHERE YEAR(Fecha) = $anio AND MONTH(Fecha)=$mes_aux ";
					//echo $consulta;
					$datosS = mysqli_query($con,$consultaS);
					$rowS = mysqli_fetch_array($datosS, MYSQLI_ASSOC);
	  				
		 			if (!isset($rowS['idSaldo']) ){
		 				$valor = 0;
		 				echo "<td class=xl63 width:'40px' style=color:green;>";
      					echo "<input type='text' name='#.$mes' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:#09ACB7;'>";		      			
						echo "</td>";
		 			}else{
		 				$id = $rowS['idSaldo'];
		 				$valor = $rowS['Saldo'];
		 				echo "<td class=xl63 width:'40px' style=color:green;>";
      					echo "<input type='text' name='%.$id' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:#09ACB7;'>";		      			
						echo "</td>";
		 			}
		 			
		 			break;
		 			case 2:
		 			$valor = $row['Ingreso'];
		 			if (!isset($id) ){
			 			echo "<td class=xl63 width:'40px' style=color:green;>";
	      				echo "<input type='text' name='!.$mes.ing'class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:#09ACB7;'>";		      			
						echo "</td>";
					}else{
						echo "<td class=xl63 width:'40px' style=color:green;>";
      					echo "<input type='text' name='@.$id' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:#09ACB7;'>";		      			
						echo "</td>";
					}
		 			break;
		 			case 3:
		 			$query_2 = "SELECT sum(Total) FROM movimientos WHERE Tipo = 1 AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
		 			//if ($mes > $hoy){
		 			//	$query_2 = "SELECT sum(Total) FROM movimientos WHERE Tipo = 1 AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
		 			//}
		 			
			  		//echo $consulta;
			      	//echo "<br>";
			        $datos2 = mysqli_query($con,$query_2);
			        $row2 = mysqli_fetch_array($datos2, MYSQLI_ASSOC);
			        $sum = $row2['sum(Total)'];
			        if ($sum < 0){
			        	$sum = -$sum;
			        }
		 			$valor = number_format(round($sum,2), 2, ",", ".");
		 			echo "<td class=xl135 align=center>".$valor."</td>";
		 			break;

		 			case 4:
		 			$query_20 = "SELECT sum(Total) FROM movimientos WHERE Tipo = 1 AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
		 			
			  		//echo $consulta;
			      	//echo "<br>";
			        $datos02 = mysqli_query($con,$query_20);
			        $row20 = mysqli_fetch_array($datos02, MYSQLI_ASSOC);
		 			$sum = floatval($row20['sum(Total)']);
			        if ($sum < 0){
			        	$sum = -$sum;
			        }
			        //echo $sum;
			        //echo "<br>";
			        $ahorro = floatval($row['Ingreso']) - round($sum,2);
			        //echo $ahorro;
			        //echo "<br>";
		 			$valor = number_format(-$ahorro, 2, ",", ".");
		 			echo "<td class=xl131 align=left>".$valor."</td>";
		 			break;

		 			case 5:
	 			 	$sql = "SELECT * FROM `cotizacion` WHERE month(Fecha) = $mes and Year(fecha) = $anio";
				    $d = mysqli_query($con,$sql);

				    if(null != ($row = mysqli_fetch_array($d, MYSQLI_ASSOC))){
				    	if ($mes <= $hoy){
				    		$coti = round(floatval($row['Cotizacion']),2);
				    		$aux_cot = $coti;
				    	}
				    	if ($mes == $hoy){
				    		//$coti = $aux_cot;
				    	}
				    	$coti = round(floatval($row['Cotizacion']),2);
				    	if ($mes > $hoy){
				    		$coti = round(floatval($row['Cotizacion']),2);
				    	}	
				    }
					    	
		 			echo "<td class=xl110 align=center>".$coti."</td>";
		 			break;

		 			case 6:
		 			$query_20 = "SELECT sum(Total) FROM movimientos WHERE Tipo = 1 AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
		 			
			  		//echo $consulta;
			      	//echo "<br>";
			        $datos02 = mysqli_query($con,$query_20);
			        $row20 = mysqli_fetch_array($datos02, MYSQLI_ASSOC);
		 			$sum = floatval($row20['sum(Total)']);
			        if ($sum < 0){
			        	$sum = -$sum;
			        }
			        //echo $sum;
			        //echo "<br>";
			        $ahorro = floatval($row['Ingreso']) - round($sum,2);
			        $sql = "SELECT * FROM `cotizacion` WHERE month(Fecha) = $mes and Year(fecha) = $anio";
				    $d = mysqli_query($con,$sql);

				    if(null != ($row = mysqli_fetch_array($d, MYSQLI_ASSOC))){
				    	$coti = round(floatval($row['Cotizacion']),2);
				    	if ($mes > $hoy){
				    		$coti = round(floatval($row['Cotizacion']),2);
				    	}	
				    }
			        //echo $ahorro;
			        //echo "<br>";
			        if ($coti == 0){
			        	$anio = $anio -1;
			        	$sql34 = "SELECT * FROM `cotizacion` WHERE month(Fecha) = $mes and Year(fecha) = $anio";
			        	$d34 = mysqli_query($con,$sql34);

					    if(null != ($row34 = mysqli_fetch_array($d34, MYSQLI_ASSOC))){
					    	$coti = round(floatval($row34['Cotizacion']),2);
					    	if ($mes > $hoy){
					    		$coti = round(floatval($row34['Cotizacion']),2);
					    	}	
					    }

			        }

		 			$valor = number_format(-$ahorro / $coti, 2, ",", ".");
		 			echo "<td class=xl110 align=center>".$valor."</td>";
		 			break;
					    
		 		}
		 	
			}
		  	echo "</tr>";
		  //}	
    	//}
    	echo "<tr height=21 style='height:16.0pt'>";
      	echo "<td width:'40px' height=21 class=xl74 style='height:16.0pt'></td>";
      	echo "<td></td>";
	  	
	  	echo "</tr>"; 
	} 
?>
 	 <tr height=21 style='height:16.0pt'>
		<td height=21 class=xl76 style='height:16.0pt'></td>
		<td></td>
		<td class=xl79></td>
		<td class=xl63></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl80></td>
	</tr>
	 <tr height=21 style='height:16.0pt'>
		<td height=21 class=xl76 style='height:16.0pt'></td>
		<td></td>
		<td class=xl79></td>
		<td class=xl63></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl80></td>
	</tr>
	 <tr height=21 style='height:16.0pt'>
		<td height=21 class=xl76 style='height:16.0pt'></td>
		<td></td>
		<td class=xl79></td>
		<td class=xl63></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl80></td>
	</tr>
<!--Fijos!!!-------->
	<tr height=21 style='height:16.0pt'>
	    <td height=21 class=xl99 style='height:16.0pt'></td>
	    <td colspan=13 class=xl118>FIJOS</td>
	    <td class=xl80></td>
    </tr>
    <tr height=21 style='height:16.0pt'>
		<td height=21 class=xl76 style='height:16.0pt'></td>
		<td></td>
		<td class=xl79></td>
		<td class=xl63></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl79></td>
		<td class=xl80></td>
	</tr>
	<tr height=21>
        <td></td>
        <td></td>
        <td colspan=12>
	<?php
		$anio = 2022;
		$data = array(); 

		for ($mes = 1; $mes < 13; $mes ++){

		    //$con = new mysqli("localhost","root","","chartjs10"); // Conectar a la BD
		    $sql = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 1 and Usuario = $user and year(Fecha)= $anio and month(Fecha) = $mes and Categoria = 10"; // 
		    //echo $sql;

		    $datos = mysqli_query($con,$sql);
		    //$sql = "select * from venta";
		    $vector = new stdClass;
		    while($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)){ // Recorrer los resultados de Ejecutar la consulta SQL
		        //print_r($row);
		        //echo "<br>";
		        $vector->mes = $row['month(Fecha)'];
		        $vector->valor = round($row['sum(Total)'],2);
		        array_push($data, $vector);
    }
}
//print_r($data);
    //echo "<br>";
		$data2 = array(); 
		
		for ($mes2 = 1; $mes2 < 13; $mes2 ++){

		    //$con = new mysqli("localhost","root","","chartjs10"); // Conectar a la BD
		    $sql2 = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 2 and Usuario = $user and month(Fecha) = $mes2 and Year(Fecha)= $anio and Categoria = 10"; // 
		    //echo $sql2;
		//echo "<br>";
		    $datos2 = mysqli_query($con,$sql2);
		    //$sql = "select * from venta";
		    $vector2 = new stdClass;
		    while($row2 = mysqli_fetch_array($datos2, MYSQLI_ASSOC)){ // Recorrer los resultados de Ejecutar la consulta SQL
		        //print_r($row2);
		        //echo "<br>";
		        $vector2->mes = $row2['month(Fecha)'];
		        $vector2->valor = -round($row2['sum(Total)'],2);
		        array_push($data2, $vector2);
		        

		    }
		}
//print_r($data2);
    //echo "<br>";
?>

<canvas id="chart1" style="width:90%;" height="70"></canvas>
</td></tr>
<script>
var ctx = document.getElementById("chart1");
var data = {
        labels: [ "Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"
        
        ],

        datasets: [
            {
                label: 'PRESUPUESTO',
                data: [
                    <?php foreach($data as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'green',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'green',
                pointBackgroundColor: 'green',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 2,
            },
            {
                label: 'GASTOS',
                data: [
                    <?php foreach($data2 as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'red',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'red',
                pointBackgroundColor: 'red',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 1,
        }]
    };

var options = {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    };
var chart1 = new Chart(ctx, {
    type: 'line', /* valores: line, bar*/
    data: data,
    options: options
});
</script>
	
          <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
	  <td></td>
	  <td class=xl79></td>
	  <td class=xl63></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl80></td>
 </tr>  
<tr height=21 style='height:16.0pt'>
    <td height=21 class=xl63 style='height:16.0pt'></td>
    <td></td>
    <td class=xl97>Ene</td>
    <td class=xl97 style='border-left:none'>Feb</td>
    <td class=xl97 style='border-left:none'>Mar</td>
    <td class=xl97 style='border-left:none'>Abr</td>
    <td class=xl97 style='border-left:none'>May</td>
    <td class=xl98 style='border-left:none'>Jun</td>
    <td class=xl97 style='border-left:none'>Jul</td>
    <td class=xl97 style='border-left:none'>Ago</td>
    <td class=xl97 style='border-left:none'>Sep</td>
    <td class=xl97 style='border-left:none'>Oct</td>
    <td class=xl97 style='border-left:none'>Nov</td>
    <td class=xl98 style='border-left:none'>Dic</td> 
</tr>
	 
 	<?php
 		
 		$cat_usada = 10;
 		
        $consulta = "SELECT idProducto, NombreProducto FROM productos INNER join personales on personales.usuario = $user and personales.producto = productos.IdProducto WHERE productos.Categoria = $cat_usada ORDER BY NombreProducto ASC";
      	//echo $consulta;
      	//echo "<br>";
        $datos = mysqli_query($con,$consulta);
        
        while ($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)) {
        	//print_r($row);
        	//echo "<br>";
     	  $mes = 1;
	      $id = $row['idProducto'];
	      $prod = cortar_cadena_14( $row['NombreProducto']);
	      //printf("%s | ", $prod);
	      //$query = "SELECT Total FROM movimientos WHERE Usuario = 3 AND Tipo = 2 AND YEAR(Fecha) = 2022 AND MONTH(Fecha) = $mes and Producto = $id";
	      echo "<tr height=5 style='height:16.0pt'>";
      	  echo "<td height=5 width:'40px' class=xl76 style='height:16.0pt'></td>";
      	  echo "<td width:'100px'><div  class='input-group input-group mb-3'>".$prod."</div></td>";
	  	  	
  			for ($mes ; $mes < 13; $mes++){
  				$hoy = intval(date('m'));
  				$fecha = "2021-12-1";
  				$anio = date('Y',strtotime($fecha."+".$mes. "month"));
  				//echo $anio;
  				$mes_aux = date('m',strtotime($fecha."+".$mes. "month"));

				$query2 = "SELECT idMovimiento, Total FROM movimientos WHERE Usuario = $user AND Tipo = 2 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes_aux and Producto = $id";

				$data2 = mysqli_query($con,$query2);
				$row2 = mysqli_fetch_array($data2, MYSQLI_ASSOC);
				//print_r($row2);
				//echo "<br>";
				if(empty($row2['Total'])){
					$query2 = "SELECT idMovimiento, Total FROM movimientos WHERE Usuario = $user AND Tipo = 1 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes_aux and Producto = $id";
					
					$data2 = mysqli_query($con,$query2);
  					$row2 = mysqli_fetch_array($data2, MYSQLI_ASSOC);
				}
				//echo $query2;
				//echo "<br>";
				
				
  				//print_r($row2);
  				//echo "<br>";
  				
	      		$valor = floatval($row2['Total']);
	      		$id_mov =  $row2['idMovimiento'];
	      //	printf($valor);
	      		if ($mes < $hoy ){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			if ($valor < 0 ){
		      			echo "<input type='text' readonly class='form-control' value='".-$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:red;'>";		      			
	      			}elseif ($valor == 0) {
	      				echo "<input type='text' name='*$cat_usada.$mes.$id' class='form-control' value='' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";
	      			}else{
	      				echo "<input type='text' readonly class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      			}
	      			
	      		}
	      		if ($mes == $hoy && $valor != 0){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			if ($valor < 0 ){
		      			echo "<input type='text' readonly class='form-control' value='".-$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:red;'>";		      			
	      			}else{
	      				echo "<input type='text'  name='' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      			}
	      			
	      		}
	      		if ($mes > $hoy && $valor == 0 ){
	      			$valr = ".";
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			echo "<input type='text' name='*$cat_usada.$mes.$id' class='form-control' value='' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      		}
	      		if ($mes == $hoy && $valor == 0 ){
	      			$valr = ".";
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			echo "<input type='text' name='*$cat_usada.$mes.$id' class='form-control' value='' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      		}
	      		if ($mes > $hoy && $valor > 0 ){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			echo "<input type='text' name='$id_mov' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";
	      		}
	      		if ($mes > $hoy && $valor < 0){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
		      		echo "<input type='text' readonly class='form-control' value='".-$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:red;'>";		      			
	      		}
					echo "</div>";
					echo "</td>"; 	
			}
		  	echo "</tr>";
		  //}	
    	}
    	echo "<tr height=21 style='height:16.0pt'>";
      	echo "<td width:'40px' height=21 class=xl74 style='height:16.0pt'></td>";
      	echo "<td></td>";
	  	
	  	for ($i = 1 ; $i < 13; $i++){
	  		//echo "i: ".$i;
	  		//echo "<br>";
	  		$anio = 2022;
	  		$mes = $i;
	  		if($i > 12){
	  			$anio = 2022;
	  			$mes = $i - 12;
	  		}

	  		if ($i < $hoy ){
	  			$query3 = "SELECT sum(Total) FROM movimientos WHERE Categoria = $cat_usada AND Tipo = 2 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = '$mes' AND Usuario = $user";
	  			$gasto = suma_gastos_consulta($query3,$con);
	  			$gasto = - $gasto;
	  			//echo $query3;
	  			//echo "<br>";
	  		}else{
	  			$query3 = "SELECT sum(Total) FROM movimientos WHERE Categoria = $cat_usada AND Tipo = 1 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = '$mes' AND Usuario = $user";
	  			$gasto = suma_gastos_consulta($query3,$con);
	  			//echo $query3;
	  			//echo "<br>";
	  		}

	  		if ($i == $hoy ){
	  			
	  			$query = "SELECT sum(Total) FROM movimientos WHERE Categoria = $cat_usada AND Tipo = 1 AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
	  			//echo $query3;
	  			$gasto = suma_gastos_consulta($query,$con);
	  			if ($gasto == 0){
	  				$query = "SELECT sum(Total) FROM movimientos WHERE Categoria = $cat_usada AND Tipo = 2 AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
	  			//echo $query3;
	  			$gasto = -suma_gastos_consulta($query,$con);
	  			}
	  			
	  		}
	  		//echo "G:".$gasto;
	  		//echo "<br>";
	  		if (empty($gasto)){
	  			echo "<td class=xl78>0</td>";
	  		}else{
	  			echo "<td  class=xl78>".number_format(round($gasto,2), 2, ",", ".")."</td>";
	  		}
	  	}
	  	echo "</tr>";  
 	?>

 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
  <td></td>
  <td class=xl79></td>
  <td class=xl63></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
  <td></td>
  <td class=xl79></td>
  <td class=xl63></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
  <td></td>
  <td class=xl79></td>
  <td class=xl63></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl80></td>
 </tr>
<!---------------------------------TARJETAS!!!!---------------------------------------------------------------------------------->
<?php


		 function curl2($url) {
	        $ch = curl_init($url); // Inicia sesión cURL
	        curl_setopt($ch, CURLOPT_RETURNTRANSFER, TRUE); // Configura cURL para devolver el resultado como cadena
	        curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false); // Configura cURL para que no verifique el peer del certificado dado que nuestra URL utiliza el protocolo HTTPS
	        $info = curl_exec($ch); // Establece una sesión cURL y asigna la información a la variable $info
	        curl_close($ch); // Cierra sesión cURL

	        return $info; // Devuelve la información de la función
	    }

	    $sitioweb = curl2("https://www.cronista.com/MercadosOnline/moneda.html?id=ARS");  // Ejecuta la función curl escrapeando el sitio web https://devcode.la and regresa el valor a la variable $sitioweb
	   // echo $sitioweb;
	    $doc = new DOMDocument();
	    @$doc -> loadHTML($sitioweb);

	    $finder = new DomXPath($doc);
	    $classname2="sell-value";
	    //$classname2="val";

	    $nodes = $finder->query("//*[contains(concat(' ', normalize-space(@class), ' '), ' $classname ')]");

	    $nodes2 = $finder->query("//*[contains(concat(' ', normalize-space(@class), ' '), ' $classname2 ')]");

	    $coti = array();
	    $i = 0;

	   
	    foreach($nodes2 as $texto2){
	        $coti[$i] = $texto2->nodeValue;
	        $i++;
	    }

	   	//print_r($coti);
	   	//printf($coti[0]);
	 	$oficial =$coti[0];
	 	//printf($oficial);
	 	$oficial =sacar_simbolo($oficial);

 	$w = 0;
	$tarjeta = 1;
	$char = 5;
	$today = intval(date('m'));
	$imp_pais = 1.30;
	$imp_ingbrutos = 1.35;

	
	$qu_tarjeta = "SELECT categorias.categoria, categorias.idCategoria FROM categorias INNER join usercategoria on usercategoria.usuario = $user and usercategoria.user_categoria = categorias.IdCategoria where categorias.tarjeta = $tarjeta";
	// consulta para listar las categorias que existen !
	//echo $qu_tarjeta;
	//echo "<br>";
	$d_tarjeta = mysqli_query($con,$qu_tarjeta);
	while($r_tarjeta = mysqli_fetch_array($d_tarjeta, MYSQLI_ASSOC)){
		$w++;
		if ($w == 2){
			echo "<tr>";
			echo "<td></td>";
			echo "<td></td>";
			for ($u = 1; $u < $today; $u++){
				echo "<td></td>";
			}
			for ( $o = $today; $o < 13; $o ++){
				echo "<td class=xl110 align=center>".round((round($oficial,2)*1.65),2)."</td>"; //DOLAR OFICIAL!!!
			}
			echo "<tr>";
		}
		

		//print_r($r_tarjeta);
		//echo "<br>";
		$cat_usada = $r_tarjeta['idCategoria'];
		$credit_card = $r_tarjeta['categoria'];
		//echo $cat_usada;
		//echo "<br>";
		echo <<<END
			<tr class=xl99 height=21 style='height:16.0pt'>
			  <td height=13 class=xl99 style='height:16.0pt'></td>
		END;
		echo "<td colspan=13 class=xl118>".strtoupper($r_tarjeta['categoria'])."</td>";
		echo "</tr>";
		$data = array(); 
		$anio = 2022;
		for ($mes = 1; $mes < 13; $mes ++){

		    //$con = new mysqli("localhost","root","","chartjs10"); // Conectar a la BD
		    $sql = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 1 and Usuario = $user and year(Fecha) = $anio and month(Fecha) = $mes and Categoria = $cat_usada"; // 
		    //echo $sql;

		    $datos = mysqli_query($con,$sql);
		    //$sql = "select * from venta";
		    $vector = new stdClass;
		    while($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)){ 
		        $vector->mes = $row['month(Fecha)'];
		        $vector->valor = round($row['sum(Total)'],2);
		        array_push($data, $vector);
   	 		}
		}
		//print_r($data);
		//echo "<br>";
		$data2 = array(); 

		for ($mes2 = 1; $mes2 < 13; $mes2 ++){

		    $sql2 = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 2 and Usuario = $user and year(Fecha) = $anio and month(Fecha) = $mes2 and Categoria = $cat_usada"; // 

		    $datos2 = mysqli_query($con,$sql2);
		    $vector2 = new stdClass;
		    while($row2 = mysqli_fetch_array($datos2, MYSQLI_ASSOC)){
		        $vector2->mes = $row2['month(Fecha)'];
		        $vector2->valor = -round($row2['sum(Total)'],2);
		        array_push($data2, $vector2);
		    }
		}
		//print_r($data2);
	//echo $char;
	echo "<tr height=21>";
	    echo "<td></td>";
	    echo "<td></td>";
    	echo "<td colspan=12>";
			echo "<canvas id='chart".$char."' style='width:90%;' height='70'></canvas>";
		echo "</td>";
	echo "</tr>";
	

?>

<script>
	<?php echo "var ctx = document.getElementById('chart$char');";
	$char++;
	?>
	var data = {
        labels: [ "Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"
        
        ],

        datasets: [
            {
                label: 'PRESUPUESTO',
                data: [
                    <?php foreach($data as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'green',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'green',
                pointBackgroundColor: 'green',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 2,
            },
            {
                label: 'GASTOS',
                data: [
                    <?php foreach($data2 as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'red',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'red',
                pointBackgroundColor: 'red',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 1,
        }]
    };

var options = {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    };
	var chart1 = new Chart(ctx, {
	    type: 'line', /* valores: line, bar*/
	    data: data,
	    options: options
	});
</script>
        <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
	  <td></td>
	  <td class=xl79></td>
	  <td class=xl63></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl80></td>
 </tr> 
<?php
		echo <<<END
			<tr height=21 style='height:16.0pt'>
			    <td height=21 class=xl63 style='height:16.0pt'></td>
			    <td></td>
			    <td class=xl97>Ene</td>
			    <td class=xl97 style='border-left:none'>Feb</td>
			    <td class=xl97 style='border-left:none'>Mar</td>
			    <td class=xl97 style='border-left:none'>Abr</td>
			    <td class=xl97 style='border-left:none'>May</td>
			    <td class=xl98 style='border-left:none'>Jun</td>
			    <td class=xl97 style='border-left:none'>Jul</td>
			    <td class=xl97 style='border-left:none'>Ago</td>
			    <td class=xl97 style='border-left:none'>Sep</td>
			    <td class=xl97 style='border-left:none'>Oct</td>
			    <td class=xl97 style='border-left:none'>Nov</td>
			    <td class=xl98 style='border-left:none'>Dic</td> 
			</tr>
		END;
 		
        $consulta = "SELECT idProducto, NombreProducto FROM productos INNER join personales on personales.usuario = $user and personales.producto = productos.IdProducto WHERE productos.Categoria = $cat_usada ORDER BY NombreProducto ASC";
        //$consulta = "SELECT idProducto, NombreProducto FROM productos WHERE Categoria = 10 ORDER BY NombreProducto ASC";
        $datos = mysqli_query($con,$consulta);
        
        while ($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)) {
        	//print_r($row);
        	//echo "<br>";
     	  $mes = 1;
	      $id = $row['idProducto'];
	      $prod = cortar_cadena_14( $row['NombreProducto']);
	      //printf("%s | ", $prod);
	      //$query = "SELECT Total FROM movimientos WHERE Usuario = 3 AND Tipo = 2 AND YEAR(Fecha) = 2022 AND MONTH(Fecha) = $mes and Producto = $id";
	      echo "<tr height=5 style='height:16.0pt'>";
      	  echo "<td height=5 width:'40px' class=xl76 style='height:16.0pt'></td>";
      	  

      	  echo "<td width:'100px'><div  class='input-group input-group mb-3'>".$prod."</div></td>";
	  		
  			for ($mes ; $mes < 13; $mes++){
  				$hoy = intval(date('m'));
  				$fecha = "2021-12-1";
  				$anio = date('Y',strtotime($fecha."+".$mes. "month"));
  				$mes_aux = date('m',strtotime($fecha."+".$mes. "month"));

  					$query2 = "SELECT idMovimiento, Total FROM movimientos WHERE Usuario = $user AND Tipo = 2 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes_aux and Producto = $id";
  					$data2 = mysqli_query($con,$query2);
  					$row = mysqli_fetch_array($data2, MYSQLI_ASSOC);
  					//print_r($row);
  					if(empty($row['Total'])){

  						$query2 = "SELECT idMovimiento, Total FROM movimientos WHERE Usuario = $user AND Tipo = 1 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes_aux and Producto = $id";
  					}
  				
	  			
	      		$data2 = mysqli_query($con,$query2);
	      		$row = mysqli_fetch_array($data2, MYSQLI_ASSOC);
	      		
	      		$valor = floatval($row['Total']);
	      		$id_mov =  $row['idMovimiento'];
	      		
	      		if ($mes < $hoy){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			if ($valor < 0){
		      			echo "<input type='text' readonly class='form-control' value='".-$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:red;'>";	
	      			}elseif ($valor == 0) {
	      				echo "<input type='text'  name='' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	      			
	      			}else{
	      				echo "<input type='text' readonly class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      			}
	      			
	      		}
	      		if ($mes == $hoy){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			if ($valor < 0){
		      			echo "<input type='text' class='form-control' value='".-$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:red;'>";		      			
	      			}else{
	      				echo "<input type='text' name='$id_mov'class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      			}
	      			
	      		}
	      		if ($mes > $hoy && $valor == 0){
	      			$valr = ".";
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			echo "<input type='text' name='*$cat_usada.$mes.$id' class='form-control' value='' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      		}
	      		if ($mes > $hoy && $valor > 0){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			echo "<input type='text' name='$id_mov' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      		}
					echo "</div>";
					echo "</td>";
	      		
			  	
			}
		  	echo "</tr>";
		  //}	
    	}
    	echo "<tr height=21 style='height:16.0pt'>";
      	echo "<td width:'40px' height=21 class=xl74 style='height:16.0pt'></td>";
      	echo "<td></td>";
	  	for ($i = 1 ; $i < 13; $i++){
	  		//echo "i: ".$i;
	  		//echo "<br>";
	  		$anio = 2022;
	  		$mes = $i;
	  		if($i > 12){
	  			$anio = 2022;
	  			$mes = $i - 12;
	  		}

	  		if ($i < $hoy ){
	  			$query3 = "SELECT sum(Total) FROM movimientos WHERE Categoria = $cat_usada AND Tipo = 2 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = '$mes' AND Usuario = $user";
	  			$gasto = suma_gastos_consulta($query3,$con);
	  			$gasto = - $gasto;
	  		}else{
	  			$query3 = "SELECT sum(Total) FROM movimientos WHERE Categoria = $cat_usada AND Tipo = 1 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = '$mes' AND Usuario = $user";
	  			$gasto = suma_gastos_consulta($query3,$con);
	  			//echo $query3;
	  			//echo "<br>";
	  		}

	  		if ($i == $hoy ){
	  			
	  			$query = "SELECT sum(Total) FROM movimientos WHERE Categoria = $cat_usada AND Tipo = 1 AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
	  			//echo $query3;
	  			$gasto = suma_gastos_consulta($query,$con);
	  			if ($gasto == 0){
	  				$query = "SELECT sum(Total) FROM movimientos WHERE Categoria = $cat_usada AND Tipo = 2 AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
	  			//echo $query3;
	  				$gasto = -suma_gastos_consulta($query,$con);
	  			}
	  			//echo "G:".$gasto;
	  		}

	  		if (empty($gasto)){
	  			echo "<td class=xl78>0</td>";
	  		}else{
	  			echo "<td  class=xl78>".number_format(round($gasto,2), 2, ",", ".")."</td>";
	  		}
	  	}
	  	echo "</tr>";
      
	  	echo <<<END
		 <tr height=21 style='height:16.0pt'>
		  <td height=21 class=xl76 style='height:16.0pt'></td>
		  <td></td>
		  <td class=xl79></td>
		  <td class=xl63></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl80></td>
		 </tr>
		 <tr height=21 style='height:16.0pt'>
		  <td height=21 class=xl76 style='height:16.0pt'></td>
		  <td></td>
		  <td class=xl79></td>
		  <td class=xl63></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl80></td>
		 </tr>
		 <tr height=21 style='height:16.0pt'>
		  <td height=21 class=xl76 style='height:16.0pt'></td>
		  <td></td>
		  <td class=xl79></td>
		  <td class=xl63></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl79></td>
		  <td class=xl80></td>
		 </tr>
		
		END;
}	
?>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
  <td></td>
  <td class=xl79></td>
  <td class=xl63></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl79></td>
  <td class=xl80></td>
 </tr>


<!---------------------------------------------------------------------------------------------------------------------->

 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=13 class=xl118>INSUMOS</td>
  <td ></td>
  <?php 
  	 $data10 = array(); 
  	 $anio = 2022;
    for ($mes = 1; $mes < 13; $mes ++){
        
        $sql = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 1 and Usuario = $user and Year(Fecha) = $anio and month(Fecha) = $mes and Categoria != 10 and categoria != 11 and categoria != 12 and categoria != 36"; 
      
        $datos = mysqli_query($con,$sql);
        $vector = new stdClass;
        while($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)){
            $vector->mes = $row['month(Fecha)'];
            $vector->valor = round($row['sum(Total)'],2);
            array_push($data10, $vector);
        }
    }
    //print_r($data);
    //echo "<br>";
    $data20 = array();

    for ($mes2 = 1; $mes2 < 13; $mes2 ++){
    	//echo $mes2;
    	//echo "<br>";
        $sql2 = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 2 and Usuario = $user and Year(Fecha) = $anio and month(Fecha) =$mes2 and Categoria != 10 and categoria != 11 and categoria != 12 and categoria != 36";
        //echo $sql;
        //echo "<br>";
        $datos2 = mysqli_query($con,$sql2);
        $vector2 = new stdClass;
        while($row2 = mysqli_fetch_array($datos2, MYSQLI_ASSOC)){
            $vector2->mes = $row2['month(Fecha)'];
            $vector2->valor = -round($row2['sum(Total)'],2);
            array_push($data20, $vector2);
        }
    }
    //print_r($data20);
  	//echo "<br>";
	  echo "<tr height=21>";
	      echo "<td></td>";
	      echo "<td></td>";
	      echo "<td colspan=12>";
	      echo "<canvas id='chart50' style='width:90%;' height='70'></canvas>";
	    echo "</td>";
	  echo "</tr>";
  ?>
  <script>
  var ctx = document.getElementById('chart50');
 
  var data = {
        labels: [ "Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"
        
        ],

        datasets: [
            {
                label: 'PRESUPUESTO',
                data: [
                    <?php foreach($data10 as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'green',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'green',
                pointBackgroundColor: 'green',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 2,
            },
            {
                label: 'GASTOS',
                data: [
                    <?php foreach($data20 as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'red',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'red',
                pointBackgroundColor: 'red',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 1,
        }]
    };

var options = {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    };
  var chart1 = new Chart(ctx, {
      type: 'line', /* valores: line, bar*/
      data: data,
      options: options
  });
</script>
        <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl76 style='height:16.0pt'></td>
	  <td></td>
	  <td class=xl79></td>
	  <td class=xl63></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl79></td>
	  <td class=xl80></td>
 </tr>  
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
    <td height=21 class=xl63 style='height:16.0pt'></td>
    <td></td>
    <td class=xl97>Ene</td>
    <td class=xl97 style='border-left:none'>Feb</td>
    <td class=xl97 style='border-left:none'>Mar</td>
    <td class=xl97 style='border-left:none'>Abr</td>
    <td class=xl97 style='border-left:none'>May</td>
    <td class=xl98 style='border-left:none'>Jun</td>
    <td class=xl97 style='border-left:none'>Jul</td>
    <td class=xl97 style='border-left:none'>Ago</td>
    <td class=xl97 style='border-left:none'>Sep</td>
    <td class=xl97 style='border-left:none'>Oct</td>
    <td class=xl97 style='border-left:none'>Nov</td>
    <td class=xl98 style='border-left:none'>Dic</td> 
</tr>
 <?php
	
    $consulta = "SELECT usercategoria.user_categoria from usercategoria where usuario = $user ";
    $datos = mysqli_query($con,$consulta);
    
    while ($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)) {
    	$id = intval($row['user_categoria']);	
    	
    	if ($id != 10 && $id != 11 && $id != 12 && $id != 36){

          	$consulta2 = "SELECT Categoria from categorias where idCategoria = $id order by Categoria ASC";
	        $datos2 = mysqli_query($con,$consulta2);
	        $row2= mysqli_fetch_array($datos2, MYSQLI_ASSOC);
       
			$mes = 1;

			$cat = cortar_cadena_14( $row2['Categoria']);
		
			echo "<tr height=5 style='height:16.0pt'>";
			echo "<td height=5 width:'40px' class=xl76 style='height:16.0pt'></td>";
			echo "<td width:'100px'><div  class='input-group input-group mb-3'>".$cat."</div></td>";

			for ($mes ; $mes < 13; $mes++){
				$hoy = intval(date('m'));
				$fecha = "2021-12-1";
				$anio = date('Y',strtotime($fecha."+".$mes. "month"));
				$mes_aux = date('m',strtotime($fecha."+".$mes. "month"));

				$query2 = "SELECT idMovimiento, sum(Total) FROM movimientos WHERE Usuario = $user AND Tipo = 1 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes_aux and categoria = $id";

				if($mes <= $hoy){

				$query2 = "SELECT idMovimiento, sum(Total) FROM movimientos WHERE Usuario = $user AND Tipo = 2 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes_aux and categoria = $id";
				}
				//echo $query2;
				//echo "<br>";
				$data3 = mysqli_query($con,$query2);
				$row3 = mysqli_fetch_array($data3, MYSQLI_ASSOC);
				//print_r($row3);
			//echo "<br>";
				$valor = floatval($row3['sum(Total)']);
				$id_mov =  $row3['idMovimiento'];

	      		if ($mes < $hoy){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			
	      			if ($valor < 0){
		      			echo "<input type='text' readonly class='form-control' value='".-$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:red;'>";	
	      			}elseif ($valor == 0) {
	      				echo "<input type='text'  name='' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	      			
	      			}else{
	      				echo "<input type='text' readonly class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      			}	
	      		}

	      		if ($mes == $hoy){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			
	      			if ($valor < 0){
		      			echo "<input type='text' readonly class='form-control' value='".-$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:red;'>";	
		      		}elseif ($valor == 0) {
	      				echo "<input type='text'  name='' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	      			
	      			}else{
	      				echo "<input type='text'  readonly name=''class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      			}
	 
	      		}

	      		if ($mes > $hoy && $valor == 0){
	      			$valr = ".";
	      			$id_prod = 174;
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			echo "<input type='text' name='*$id.$mes.$id_prod' class='form-control' value='' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      		}

	      		if ($mes > $hoy && $valor > 0){
	      			echo "<td class=xl63 width:'40px' style=color:red;>";
	      			echo "<div class='input-group input-group-sm mb-3' style='text-align:right;'>";
	      			echo "<input type='text' name='$id_mov' class='form-control' value='".$valor."' aria-label='Sizing example input' aria-describedby='inputGroup-sizing-sm' style='text-align:right;color:green;'>";	
	      		}
	      		echo "</div>";
				echo "</td>";
	      	}
	  		echo "</tr>";
			
		}
	}		
	    	
	echo "<tr height=21 style='height:16.0pt'>";
  	echo "<td width:'40px' height=21 class=xl74 style='height:16.0pt'></td>";
  	echo "<td></td>";
  	
  	for ($i = 1 ; $i < 13; $i++){
  		$anio = 2022;
  		$mes = $i;
  		
  		if($i > 12){
  			$anio = 2022;
  			$mes = $i - 12;
  		}

  		if ($i <= $hoy ){
  			$query_1 = "SELECT sum(Total) FROM movimientos WHERE categoria != 10 and Categoria != 11 and Categoria != 12 AND Tipo = 2 AND YEAR(Fecha) = $anio AND MONTH(Fecha) = '$mes' AND Usuario = $user";
  			//echo $query_1;
  			$gasto = suma_gastos_consulta($query_1,$con);
  			$gasto = - $gasto;
  			//echo $gasto;
  		}

  		if ($i > $hoy ){
  			
  			$query_2 = "SELECT sum(Total) FROM movimientos WHERE categoria != 10 and Categoria != 11 and Categoria != 12 AND Tipo = 1 AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
  			$gasto = suma_gastos_consulta($query_2,$con);
  		}

  		if (empty($gasto) ){
  			echo "<td class=xl78>0</td>";
  		}else{
  			echo "<td  class=xl78>".number_format(round($gasto,2), 2, ",", ".")."</td>";
  		}
	}
	echo "</tr>";
  
?>
<tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl80></td>
 </tr>

<tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
 
  <td ></td>
  <?php 
  	 $data12 = array(); 
  	 $anio = 2022;
    for ($mes = 1; $mes < 13; $mes ++){
        
        $sql = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 1 and Usuario = $user and Year(Fecha) = $anio and month(Fecha) = $mes "; 
      
        $datos = mysqli_query($con,$sql);
        $vector = new stdClass;
        while($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)){
            $vector->mes = $row['month(Fecha)'];
            $vector->valor = round($row['sum(Total)'],2);
            array_push($data12, $vector);
        }
    }
   // print_r($data12);
    //echo "<br>";
    $data22 = array();

    for ($mes2 = 1; $mes2 < 13; $mes2 ++){
    	//echo $mes2;
    	//echo "<br>";
        $sql2 = "SELECT month(Fecha), sum(Total) FROM movimientos WHERE Tipo = 2 and Usuario = $user and Year(Fecha) = $anio and month(Fecha) =$mes2";
        //echo $sql;
        //echo "<br>";
        $datos2 = mysqli_query($con,$sql2);
        $vector2 = new stdClass;
        while($row2 = mysqli_fetch_array($datos2, MYSQLI_ASSOC)){
            $vector2->mes = $row2['month(Fecha)'];
            $vector2->valor = -round($row2['sum(Total)'],2);
            array_push($data22, $vector2);
        }
    }
    //print_r($data22);
  	//echo "<br>";
	  echo "<tr height=21>";
	      echo "<td></td>";
	      echo "<td></td>";
	      echo "<td colspan=12>";
	      echo "<canvas id='chart70' style='width:90%;' height='70'></canvas>";
	    echo "</td>";
	  echo "</tr>";
  ?>
  <script>
  var ctx = document.getElementById('chart70');
 
  var data = {
        labels: [ "Ene","Feb","Mar","Abr","May","Jun","Jul","Ago","Sep","Oct","Nov","Dic"
        
        ],

        datasets: [
            {
                label: 'PRESUPUESTO',
                data: [
                    <?php foreach($data12 as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'green',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'green',
                pointBackgroundColor: 'green',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 2,
            },
            {
                label: 'GASTOS',
                data: [
                    <?php foreach($data22 as $d):?>
                    <?php echo $d->valor;?>, 
                    <?php endforeach; ?>
                ],

                lineTension: 0,
                fill: false,
                borderColor: 'red',
                backgroundColor: 'transparent',
                //borderDash: [5, 5],
                pointBorderColor: 'red',
                pointBackgroundColor: 'red',
                pointRadius: 5,
                pointHoverRadius: 10,
                pointHitRadius: 30,
                pointBorderWidth: 1,
        }]
    };

var options = {
        scales: {
            yAxes: [{
                ticks: {
                    beginAtZero:true
                }
            }]
        }
    };
  var chart1 = new Chart(ctx, {
      type: 'line', /* valores: line, bar*/
      data: data,
      options: options
  });
</script>
</tr>


 
 
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl80></td>
 </tr>

 <tr height=21 style='height:16.0pt'>
    <td height=21 class=xl63 style='height:16.0pt'></td>
    <td></td>
    <td class=xl97>Ene</td>
    <td class=xl97 style='border-left:none'>Feb</td>
    <td class=xl97 style='border-left:none'>Mar</td>
    <td class=xl97 style='border-left:none'>Abr</td>
    <td class=xl97 style='border-left:none'>May</td>
    <td class=xl98 style='border-left:none'>Jun</td>
    <td class=xl97 style='border-left:none'>Jul</td>
    <td class=xl97 style='border-left:none'>Ago</td>
    <td class=xl97 style='border-left:none'>Sep</td>
    <td class=xl97 style='border-left:none'>Oct</td>
    <td class=xl97 style='border-left:none'>Nov</td>
    <td class=xl98 style='border-left:none'>Dic</td> 
</tr>
<!-------------------------------RESUMEN final----------------------------------------->
	
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>FIJOS</td>
  <?php
  		$cat_usada = 10;

    	$mes = 1;
    	for ($mes ; $mes < 13; $mes++){
    		$t = 1;
			$hoy = intval(date('m'));
			$fecha = "2021-12-1";
			$anio = date('Y',strtotime($fecha."+".$mes. "month"));
			//echo $anio;
			$mes_aux = date('m',strtotime($fecha."+".$mes. "month"));
			//while ($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)) {
			if ($mes < $hoy){
				$t = 2;
			}
			$consulta = "SELECT sum(Total) FROM movimientos WHERE usuario = $user AND tipo = $t AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes_aux and categoria = $cat_usada";
	  		//echo $consulta;
	      	//echo "<br>";
	        $datos = mysqli_query($con,$consulta);
	        $row = mysqli_fetch_array($datos, MYSQLI_ASSOC);
	        $sum = $row['sum(Total)'];
	        if ($sum < 0){
	        	$sum = -$sum;
	        }
	        echo "<td class=xl120 align=right>".number_format(round($sum,2), 2, ",", ".")."</td>";

        }			
  ?>
  
 </tr>
 
  <?php
  		$tarjeta = 1;

		$qu_tarjeta = "SELECT categorias.categoria, categorias.idCategoria FROM categorias INNER join usercategoria on usercategoria.usuario = $user and usercategoria.user_categoria = categorias.IdCategoria where categorias.tarjeta = $tarjeta";
		//echo $qu_tarjeta;
		//echo "<br>";
		$d_tarjeta = mysqli_query($con,$qu_tarjeta);
		while($r_tarjeta = mysqli_fetch_array($d_tarjeta, MYSQLI_ASSOC)){
			//print_r($r_tarjeta);
			//echo "<br>";
			$cat_usada = $r_tarjeta['idCategoria'];
			$credit_card = $r_tarjeta['categoria'];
			//echo $cat_usada;
			//echo "<br>";
			echo <<<END
				<tr height=21 style='height:16.0pt'>
				  <td height=21 class=xl63 style='height:16.0pt'></td>
			END;
			echo "<td>".cortar_cadena_7(strtoupper($r_tarjeta['categoria']))."<span style='mso-spacerun:yes'> </span></td>";

			
			$data = array(); 
			$anio = 2022;

	    	$mes = 1;
	    	for ($mes ; $mes < 13; $mes++){
	    		$t = 1;
				$hoy = intval(date('m'));
				$fecha = "2021-12-1";
				$anio = date('Y',strtotime($fecha."+".$mes. "month"));
				$mes_aux = date('m',strtotime($fecha."+".$mes. "month"));
				//while ($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)) {
				if ($mes < $hoy){
					$t = 2;
				}
				$consulta = "SELECT sum(Total) FROM movimientos WHERE usuario = $user AND tipo = $t AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes_aux and categoria = $cat_usada";
		  		//echo $consulta;
		      	//echo "<br>";
		        $datos = mysqli_query($con,$consulta);
		        $row = mysqli_fetch_array($datos, MYSQLI_ASSOC);
		        $sum = $row['sum(Total)'];
		        if ($sum < 0){
		        	$sum = -$sum;
		        }
		        echo "<td class=xl120 align=right>".number_format(round($sum,2), 2, ",", ".")."</td>";

	        }
        }			
  ?>
 </tr>
 
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>INSUMOS</td>
  <?php
		
				$mes = 1;
		    	for ($mes ; $mes < 13; $mes++){
		    		$t = 1;
					$hoy = intval(date('m'));
					$fecha = "2021-12-1";
					$anio = date('Y',strtotime($fecha."+".$mes. "month"));
					$mes_aux = date('m',strtotime($fecha."+".$mes. "month"));
					//while ($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)) {
					if ($mes < $hoy){
						$t = 2;
					}
					$query_2 = "SELECT sum(Total) FROM movimientos WHERE categoria != 10 and Categoria != 11 and Categoria != 12 AND Tipo = $t AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
			  		//echo $consulta;
			      	//echo "<br>";
			        $datos = mysqli_query($con,$query_2);
			        $row = mysqli_fetch_array($datos, MYSQLI_ASSOC);
			        $sum = $row['sum(Total)'];
			        if ($sum < 0){
			        	$sum = -$sum;
			        }
			        echo "<td class=xl120 align=right>".number_format(round($sum,2), 2, ",", ".")."</td>";
		        }			
  ?>
 </tr>
 <tr height=0 style='display:none'>
  <td class=xl63></td>
  <td></td>
  <td class=xl92>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl80 align=right>0,00</td>
 </tr>
 <tr height=0 style='display:none'>
  <td class=xl63></td>
  <td></td>
  <td class=xl92>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl80 align=right>0,00</td>
 </tr>
 <tr height=0 style='display:none'>
  <td class=xl63></td>
  <td></td>
  <td class=xl92>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl80 align=right>0,00</td>
 </tr>
 <tr height=0 style='display:none'>
  <td class=xl63></td>
  <td></td>
  <td class=xl92>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl93>&nbsp;</td>
  <td class=xl80 align=right>0,00</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td></td>
   <?php
		
				$mes = 1;
		    	for ($mes ; $mes < 13; $mes++){
		    		$t = 1;
					$hoy = intval(date('m'));
					$fecha = "2021-12-1";
					$anio = date('Y',strtotime($fecha."+".$mes. "month"));
					$mes_aux = date('m',strtotime($fecha."+".$mes. "month"));
					//while ($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)) {
					if ($mes < $hoy){
						$t = 2;
					}
					$query_2 = "SELECT sum(Total) FROM movimientos WHERE Tipo = $t AND YEAR(Fecha) = '$anio' AND MONTH(Fecha) = '$mes' AND Usuario = $user";
			  		//echo $consulta;
			      	//echo "<br>";
			        $datos = mysqli_query($con,$query_2);
			        $row = mysqli_fetch_array($datos, MYSQLI_ASSOC);
			        $sum = $row['sum(Total)'];
			        if ($sum < 0){
			        	$sum = -$sum;
			        }
			        echo "<td class=xl119 align=right>".number_format(round($sum,2), 2, ",", ".")."</td>";
		        }
			
    				
  ?>
  <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl80></td>
 </tr>

 <!-------------------------------DEPOSITO resumen----------------------------------------->
	<!--SELECT sum(Total) FROM movimientos WHERE Producto = 144 and month(Fecha) = 2 and Year(Fecha) = 2022 and tipo = 1-->
 <tr height=21 style='height:16.0pt'>
  

  <?php
  		$cat_usada = 10;
		$depositos = [0,0,0,0,0,0,0,0,0,0,0,0,0];
		$consulta45 = "SELECT producto FROM personales WHERE usuario = $user AND categoria = $cat_usada and banco = 1";
  		//echo $consulta45;
      	//echo "<br>";
        $datos45 = mysqli_query($con,$consulta45);
        while($row45 = mysqli_fetch_array($datos45, MYSQLI_ASSOC)){
	        $prod = $row45['producto'];
	        //print_r($row45);
	        $consulta2 = "SELECT idProducto, NombreProducto FROM productos WHERE idProducto = $prod";
	        $datos2 = mysqli_query($con,$consulta2);
	        $row2 = mysqli_fetch_array($datos2, MYSQLI_ASSOC);
	        $Prod = $row2['NombreProducto'];
	        echo "<td height=21 class=xl63 style='height:16.0pt'></td>";
	        echo "<td>".$Prod."</td>";	        

	    	
	    	for ($mes =1  ; $mes < 13; $mes++){
	    		$i = $mes;
	    		$t = 1;
				$hoy = intval(date('m'));
				$fecha = "2021-12-1";
				$anio = date('Y',strtotime($fecha."+".$mes. "month"));
				$mes = date('m',strtotime($fecha."+".$mes. "month"));
				//while ($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)) {
				if ($mes < $hoy){
					$t = 2;
				}
				$consulta = "SELECT sum(Total) FROM movimientos WHERE usuario = $user AND tipo = $t AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes and categoria = $cat_usada and  Producto = $prod";
		  		//echo $consulta;
		      	//echo "<br>";
		        $datos = mysqli_query($con,$consulta);
		        $row = mysqli_fetch_array($datos, MYSQLI_ASSOC);
		        $sum = $row['sum(Total)'];
		        if ($sum < 0){
		        	$sum = -$sum;
		        }   

		        $depositos[$i] = $depositos[$i] + $sum;
		        echo "<td class=xl133 align=right id='spTotal".$mes2."'>".number_format(round($sum,2), 2, ",", ".")."</td>";

	        }
		echo "</tr>";
        }
	        		
        
  		$tarjeta = 1;

		$qu_tarjeta = "SELECT categorias.categoria, categorias.idCategoria FROM categorias INNER join usercategoria on usercategoria.usuario = $user and usercategoria.user_categoria = categorias.IdCategoria where categorias.tarjeta = $tarjeta";
		//echo $qu_tarjeta;
		//echo "<br>";
		$d_tarjeta = mysqli_query($con,$qu_tarjeta);
		while($r_tarjeta = mysqli_fetch_array($d_tarjeta, MYSQLI_ASSOC)){
			//print_r($r_tarjeta);
			//echo "<br>";
			$cat_usada = $r_tarjeta['idCategoria'];
			$credit_card = $r_tarjeta['categoria'];
			//echo $cat_usada;
			//echo "<br>";
			echo <<<END
				<tr height=21 style='height:16.0pt'>
				  <td height=21 class=xl63 style='height:16.0pt'></td>
			END;
			echo "<td>".cortar_cadena_7(strtoupper($r_tarjeta['categoria']))."<span style='mso-spacerun:yes'> </span></td>";

			$anio = 2022;

	    	$mes = 1;
	    	for ($mes ; $mes < 13; $mes++){
	    		$i = $mes;
	    		$t = 1;
				$hoy = intval(date('m'));
				$fecha = "2021-12-1";
				$anio = date('Y',strtotime($fecha."+".$mes. "month"));
				$mes_aux = date('m',strtotime($fecha."+".$mes. "month"));
				//while ($row = mysqli_fetch_array($datos, MYSQLI_ASSOC)) {
				if ($mes < $hoy){
					$t = 2;
				}
				$consulta = "SELECT sum(Total) FROM movimientos WHERE usuario = $user AND tipo = $t AND YEAR(Fecha) = $anio AND MONTH(Fecha) = $mes_aux and categoria = $cat_usada";
		  		//echo $consulta;
		      	//echo "<br>";
		        $datos = mysqli_query($con,$consulta);
		        $row = mysqli_fetch_array($datos, MYSQLI_ASSOC);
		        $sum = $row['sum(Total)'];
		        if ($sum < 0){
		        	$sum = -$sum;
		        }

		        $depositos[$i] = $depositos[$i] + $sum;
		    	
		        //echo $mes;
		        //echo "<br>";
		        //$depositos[$mes] = $depositos[$mes] + $sum;
		        echo "<td class=xl133 align=right>".number_format(round($sum,2), 2, ",", ".")."</td>";
		        
	        }
        }			
  ?>
 </tr>
 
 

 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td></td>
   <?php
   //print_r($depositos);
		$total = 0;
		$mes = 1;
    	for ($i =1  ; $i < 13; $i++){
		    echo "<td class=xl110 align=right>".number_format($depositos[$i], 2, ",", ".")."</td>";
    	}				
  ?>
 
</tr>
  <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl80></td>
 </tr>
 <!--</tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td></td>
  <td class=xl111>38,89%</td>
  <td class=xl111>52,20%</td>
  <td class=xl111>46,78%</td>
  <td class=xl111>46,97%</td>
  <td class=xl111>42,12%</td>
  <td class=xl111>29,31%</td>
  <td class=xl111>40,78%</td>
  <td class=xl111>45,63%</td>
  <td class=xl111>44,56%</td>
  <td class=xl111>47,52%</td>
  <td class=xl111>42,67%</td>
  <td class=xl111>30,50%</td>
  <td class=xl111>42,67%</td>
  <td class=xl111>46,72%</td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td class=xl82>menos $</td>
  <td class=xl70>40010,68</td>
  <td class=xl70>56442,85</td>
  <td class=xl70>60689,58</td>
  <td class=xl70>61029,20</td>
  <td class=xl70>52659,83</td>
  <td class=xl70>48761,10</td>
  <td class=xl70>50342,62</td>
  <td class=xl70>58711,99</td>
  <td class=xl70>56858,62</td>
  <td class=xl70>61969,99</td>
  <td class=xl70>53600,62</td>
  <td class=xl70>51969,99</td>
  <td class=xl70>53600,62</td>
  <td class=xl70>60600,62</td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td class=xl82></td>
  <td class=xl110>266,74</td>
  <td class=xl110>370,12</td>
  <td class=xl110>397,96</td>
  <td class=xl110>400,19</td>
  <td class=xl110>345,31</td>
  <td class=xl110>319,74</td>
  <td class=xl110>330,12</td>
  <td class=xl110>385,00</td>
  <td class=xl110>372,84</td>
  <td class=xl110>406,36</td>
  <td class=xl110>351,48</td>
  <td class=xl110>340,79</td>
  <td class=xl110>351,48</td>
  <td class=xl110>397,38</td>
  <td class=xl112 align=right>5035,51</td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td class=xl82>ah</td>
  <td class=xl64>733,26</td>
  <td class=xl64>629,88</td>
  <td class=xl64>602,04</td>
  <td class=xl64>599,81</td>
  <td class=xl64>654,69</td>
  <td class=xl64>680,26</td>
  <td class=xl64>669,88</td>
  <td class=xl64>615,00</td>
  <td class=xl64>627,16</td>
  <td class=xl64>593,64</td>
  <td class=xl64>648,52</td>
  <td class=xl64>1159,21</td>
  <td class=xl64>648,52</td>
  <td class=xl64>602,62</td>
  <td class=xl112 align=right>9464,49</td>
 </tr>
 <tr class=xl80 height=21 style='height:16.0pt'>
  <td height=21 class=xl70 style='height:16.0pt'></td>
  <td class=xl116>$</td>
  <td class=xl70>109989,32</td>
  <td class=xl70>96057,15</td>
  <td class=xl70>91810,42</td>
  <td class=xl70>91470,80</td>
  <td class=xl70>99840,17</td>
  <td class=xl70>103738,90</td>
  <td class=xl70>102157,38</td>
  <td class=xl70>93788,01</td>
  <td class=xl70>95641,38</td>
  <td class=xl70>90530,01</td>
  <td class=xl70>98899,38</td>
  <td class=xl70>176780,01</td>
  <td class=xl70>98899,38</td>
  <td class=xl70>91899,38</td>
  <td class=xl80></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td class=xl82>%</td>
  <td class=xl106>61,11%</td>
  <td class=xl106>55,69%</td>
  <td class=xl106>53,22%</td>
  <td class=xl106>53,03%</td>
  <td class=xl106>57,88%</td>
  <td class=xl106>38,60%</td>
  <td class=xl106>59,22%</td>
  <td class=xl106>54,37%</td>
  <td class=xl106>55,44%</td>
  <td class=xl106>52,48%</td>
  <td class=xl106>57,33%</td>
  <td class=xl106>65,78%</td>
  <td class=xl106>57,33%</td>
  <td class=xl106>53,28%</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td class=xl82></td>
  <td></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td class=xl117>in</td>
  <td class=xl63>180000</td>
  <td class=xl63>172500</td>
  <td class=xl63>172500</td>
  <td class=xl63>172500</td>
  <td class=xl63>172500</td>
  <td class=xl63>268750</td>
  <td class=xl63>172500</td>
  <td class=xl63>172500</td>
  <td class=xl63>172500</td>
  <td class=xl63>172500</td>
  <td class=xl63>172500</td>
  <td class=xl63>268750</td>
  <td class=xl63>172500</td>
  <td class=xl63>172500</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td class=xl82>50</td>
  <td class=xl63>90000</td>
  <td class=xl63>86250</td>
  <td class=xl63>86250</td>
  <td class=xl63>86250</td>
  <td class=xl63>86250</td>
  <td class=xl63>134375</td>
  <td class=xl63>86250</td>
  <td class=xl63>86250</td>
  <td class=xl63>86250</td>
  <td class=xl63>86250</td>
  <td class=xl63>86250</td>
  <td class=xl63>134375</td>
  <td class=xl63>86250</td>
  <td class=xl63>86250</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td class=xl82>20</td>
  <td class=xl107>36000</td>
  <td class=xl107>34500</td>
  <td class=xl107>34500</td>
  <td class=xl107>34500</td>
  <td class=xl107>34500</td>
  <td class=xl107>53750</td>
  <td class=xl107>34500</td>
  <td class=xl107>34500</td>
  <td class=xl107>34500</td>
  <td class=xl107>34500</td>
  <td class=xl107>34500</td>
  <td class=xl107>53750</td>
  <td class=xl107>34500</td>
  <td class=xl107>34500</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td class=xl82>30</td>
  <td class=xl109>54000</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>80625</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>80625</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td class=xl109 style='border-left:none'>51750</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td></td>
  <td class=xl108>90000</td>
  <td class=xl108>86250</td>
  <td class=xl108>86250</td>
  <td class=xl108>86250</td>
  <td class=xl108>86250</td>
  <td class=xl108>134375</td>
  <td class=xl108>86250</td>
  <td class=xl108>86250</td>
  <td class=xl108>86250</td>
  <td class=xl108>86250</td>
  <td class=xl108>86250</td>
  <td class=xl108>134375</td>
  <td class=xl108>86250</td>
  <td class=xl108>86250</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td colspan=2 style='mso-ignore:colspan'></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td class=xl63></td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>alquiler</td>
  <td class=xl114>16965</td>
  <td class=xl114>16965</td>
  <td class=xl114>19165</td>
  <td class=xl114>19165</td>
  <td class=xl114>19165</td>
  <td class=xl114>19165</td>
  <td class=xl114>19165</td>
  <td class=xl114>19165</td>
  <td class=xl114>22423</td>
  <td class=xl114>22423</td>
  <td class=xl114>22423</td>
  <td class=xl114>22423</td>
  <td class=xl114>22423</td>
  <td class=xl114>22423</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>expensas</td>
  <td class=xl114>6500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td class=xl114>7500</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>deposito</td>
  <td class=xl114>0</td>
  <td class=xl114>0</td>
  <td class=xl114>2784,6</td>
  <td class=xl114>0</td>
  <td class=xl114>0</td>
  <td class=xl114>0</td>
  <td class=xl114>0</td>
  <td class=xl114>0</td>
  <td class=xl114>3258</td>
  <td class=xl114>0</td>
  <td class=xl114>0</td>
  <td class=xl114>0</td>
  <td class=xl114>0</td>
  <td class=xl114>0</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>seguro auto</td>
  <td class=xl114>2966</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td class=xl114>3654,5</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>edenor</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td class=xl114>750</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>cablevision</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td class=xl114>2417,25</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>santander rio</td>
  <td class=xl114>0</td>
  <td class=xl114>1160</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td class=xl114>580</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>visa</td>
  <td class=xl115>5559,43</td>
  <td class=xl115>8466,93</td>
  <td class=xl115>5553,43</td>
  <td class=xl115>5553,43</td>
  <td class=xl115>5553,43</td>
  <td class=xl115>4314,66</td>
  <td class=xl115>4265,55</td>
  <td class=xl115>4265,55</td>
  <td class=xl115>4265,55</td>
  <td class=xl115>4265,55</td>
  <td class=xl115>4265,55</td>
  <td class=xl115>4265,55</td>
  <td class=xl115>4265,55</td>
  <td class=xl115>4265,55</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td>mastercard</td>
  <td class=xl115>5707,00</td>
  <td class=xl115>8361,15</td>
  <td class=xl115>1538,80</td>
  <td class=xl115>1293,65</td>
  <td class=xl115>1293,65</td>
  <td class=xl115>264,32</td>
  <td class=xl115>264,32</td>
  <td class=xl115>264,32</td>
  <td class=xl115>264,32</td>
  <td class=xl115>264,32</td>
  <td class=xl115>264,32</td>
  <td class=xl115>264,32</td>
  <td class=xl115>264,32</td>
  <td class=xl115>264,32</td>
  <td></td>
 </tr>
 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td></td>
  <td class=xl113 align=right>40864,68</td>
  <td class=xl113 align=right>49274,826</td>
  <td class=xl113 align=right>43943,576</td>
  <td class=xl113 align=right>40913,826</td>
  <td class=xl113 align=right>40913,826</td>
  <td class=xl113 align=right>38645,726</td>
  <td class=xl113 align=right>38596,616</td>
  <td class=xl113 align=right>38596,616</td>
  <td class=xl113 align=right>45112,616</td>
  <td class=xl113 align=right>41854,616</td>
  <td class=xl113 align=right>41854,616</td>
  <td class=xl113 align=right>41854,616</td>
  <td class=xl113 align=right>41854,616</td>
  <td class=xl113 align=right>41854,616</td>
  <td></td>
 </tr>
 <![if supportMisalignedColumns]>
 <tr height=0 style='display:none'>
  <td width=28 style='width:21pt'></td>
  <td width=101 style='width:76pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=92 style='width:69pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=81 style='width:61pt'></td>
  <td width=87 style='width:65pt'></td>
 </tr>
 <![endif]>
</table>

</div>

-->
<!----------------------------->
<!--FINAL DE LOS RESULTADOS DEL ASISTENTE PARA PUBLICAR COMO PÁGINA WEB DE
EXCEL-->
<!----------------------------->

 <tr height=21 style='height:16.0pt'>
  <td height=21 class=xl63 style='height:16.0pt'></td>
  <td></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl95></td>
  <td class=xl80></td>
 </tr>
</form>
<div>
                <table width="" cellspacing="0" cellpadding="2">
                  <tr>
                    <td>
                      <a class='btn btn-outline-success' href='../../resumen2.php' role='button'>Volver</a>
                    </td>
                  </tr>
                </table>
              </div> 
    </div> 
</body>

</html>
